# ============================================
# ğŸ†• ì‹ ê·œ - kustomize/base/rbac.yaml
# ============================================
# ì›ë³¸: terraform/rbac.tf
#
# ì—­í• : CI/CD Runnerê°€ External Secrets CRDë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ ë¶€ì—¬
#
# âš ï¸ ArgoCD ì™„ì „ ì „í™˜ í›„ ì´ íŒŒì¼ì€ ì œê±° ê°€ëŠ¥:
# - ArgoCDê°€ ëª¨ë“  ë°°í¬ë¥¼ ë‹´ë‹¹í•˜ë©´ CI/CD RunnerëŠ” kubectl ì ‘ê·¼ ë¶ˆí•„ìš”
# - í˜„ì¬ëŠ” ì „í™˜ ê¸°ê°„ì´ë¯€ë¡œ ìœ ì§€
#
# ClusterRole: í´ëŸ¬ìŠ¤í„° ì „ì²´ì—ì„œ íŠ¹ì • API ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œ ì •ì˜
# ClusterRoleBinding: ìœ„ ê¶Œí•œì„ íŠ¹ì • User/SAì— ë°”ì¸ë”©
#
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: github-actions-external-secrets
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/part-of: exchange-settlement
rules:
  # External Secrets CRDì— ëŒ€í•œ ì „ì²´ CRUD ê¶Œí•œ
  - apiGroups: ["external-secrets.io"]
    resources:
      - externalsecrets
      - secretstores
      - clustersecretstores
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: github-actions-external-secrets
  labels:
    app.kubernetes.io/managed-by: kustomize
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: github-actions-external-secrets
subjects:
  # EKS Access Entryì—ì„œ ì§€ì •í•œ user_nameê³¼ ë§¤ì¹­
  - kind: User
    name: ci-cd-runner
    apiGroup: rbac.authorization.k8s.io