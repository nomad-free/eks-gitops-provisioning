# ============================================
# ğŸ†• ì‹ ê·œ - argocd/app-of-apps.yaml
# ============================================
# "App of Apps" íŒ¨í„´: í•˜ë‚˜ì˜ ë£¨íŠ¸ Applicationì´ ë‹¤ë¥¸ Applicationë“¤ì„ ê´€ë¦¬
#
# ë™ì‘ ì›ë¦¬:
# 1. ì´ íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ 1íšŒ ì ìš©: kubectl apply -f argocd/app-of-apps.yaml
# 2. ArgoCDê°€ argocd/apps/ ë””ë ‰í† ë¦¬ë¥¼ ê°ì‹œ
# 3. apps/ ì•ˆì˜ Application CRë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±/ë™ê¸°í™”ë¨
# 4. ìƒˆ ì•± ì¶”ê°€ = apps/ì— YAML íŒŒì¼ ì¶”ê°€ â†’ Git Push â†’ ìë™ ê°ì§€
#
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: root-apps
  namespace: argocd
  # Finalizer: ArgoCDì—ì„œ ì´ Appì„ ì‚­ì œí•˜ë©´ í•˜ìœ„ ë¦¬ì†ŒìŠ¤ë„ ì‚­ì œ
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default

  source:
    # ğŸ”„ ì‹¤ì œ GitHub ë¦¬í¬ì§€í† ë¦¬ URLë¡œ ë³€ê²½ í•„ìš”
    repoURL: https://github.com/nomad-free/eks-gitops-provisioning.git
    targetRevision: HEAD
    path: argocd/apps # ì´ ë””ë ‰í† ë¦¬ì˜ YAML íŒŒì¼ë“¤ì„ ëª¨ë‘ Applicationìœ¼ë¡œ ìƒì„±

  destination:
    server: https://kubernetes.default.svc # ê°™ì€ í´ëŸ¬ìŠ¤í„°
    namespace: argocd

  syncPolicy:
    automated:
      prune: true # Gitì—ì„œ ì‚­ì œë˜ë©´ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ ì‚­ì œ
      selfHeal: true # ëˆ„êµ°ê°€ kubectlë¡œ ë³€ê²½í•´ë„ Git ìƒíƒœë¡œ ë³µì›
    syncOptions:
      - CreateNamespace=true
